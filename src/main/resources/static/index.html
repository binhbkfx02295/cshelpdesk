<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Messenger</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <style>
        #messages {
            border: 1px solid #ccc;
            padding: 10px;
            max-height: 400px;
            overflow-y: auto;
            font-family: Arial, sans-serif;
        }
        .message {
            margin: 5px 0;
            padding: 5px;
            background: #f9f9f9;
            border-radius: 3px;
        }
        .success { color: green; }
        .error { color: red; }
        #connection-status { margin-bottom: 10px; font-weight: bold; }
    </style>
</head>
<body>
<h1>Messages</h1>
<div id="connection-status">Connecting...</div>
<div id="messages"></div>

<script>
        const socket = new SockJS('http://localhost:8080/ws');
        const stompClient = Stomp.over(socket);
        const maxMessages = 100; // Giới hạn số tin nhắn hiển thị

        // Hàm hiển thị thông báo
        function showMessage(content, className = 'message') {
            const messagesDiv = document.getElementById('messages');
            const div = document.createElement('div');
            div.className = className;
            div.textContent = content;
            messagesDiv.appendChild(div);

            // Giới hạn số tin nhắn
            while (messagesDiv.children.length > maxMessages) {
                messagesDiv.removeChild(messagesDiv.firstChild);
            }

            // Tự động cuộn xuống
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Kết nối WebSocket
        stompClient.connect({},
            function(frame) {
                document.getElementById('connection-status').textContent = 'Connected';
                document.getElementById('connection-status').className = 'success';
                showMessage('Connected to WebSocket server', 'success');

                // Subscribe vào topic /topic/messages
                stompClient.subscribe('/topic/messages', function(message) {
                    const msg = message.body; // Server gửi String
                    showMessage(msg);
                });
            },
            function(error) {
                document.getElementById('connection-status').textContent = 'Connection failed';
                document.getElementById('connection-status').className = 'error';
                showMessage('Error: ' + error, 'error');
            }
        );

        // Xử lý ngắt kết nối
        window.addEventListener('beforeunload', () => {
            stompClient.disconnect(() => {
                showMessage('Disconnected from WebSocket server', 'error');
            });
        });
    </script>
</body>
</html>